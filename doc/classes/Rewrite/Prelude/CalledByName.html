<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Rewrite::Prelude::CalledByName</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Rewrite::Prelude::CalledByName</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../files/lib/rewrite/prelude/called_by_name_rb.html">
                lib/rewrite/prelude/called_by_name.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
See &quot;Macros, Hygiene, and Call By Name in Ruby&quot;:<a
href="http://weblog.raganwald.com/2008/06/macros-hygiene-and-call-by-name-in-ruby.html">weblog.raganwald.com/2008/06/macros-hygiene-and-call-by-name-in-ruby.html</a>
</p>
<p>
<a href="CalledByName.html">CalledByName</a> allows you to define your own
function-like-things that are called by name rather than by value. Here is
a trivial example:
</p>
<pre>
   with(
     called_by_name(:my_or) { |arg1,  arg2|
       if  arg1
         true
       else
         !!arg2
       end
     }
   ) do
     ...
     my_or(
       true, nil.raise_missing_method_exception
     )
     ...
   end
</pre>
<p>
First, and most obviously, you get something that looks like a real
function. Procs in Ruby are just objects that capture the bindings where
theire initializing block was created, and you have to invoke them using
call or #[].
</p>
<p>
Second, and this is the funky bit, parameters inside of your
function-like-thing are called by name. Meaning, when you call your
function-like-thing, instead of evaluating each parameter&#8216;s
expression and passing its value, Ruby passes the a lambda containing
expression itself. The expression is not evaluated until the parpameter is
actually used, and if you use it more than once the expression is evaluated
more than once. This matters when there are side effects.
</p>
<p>
The example above shows how call-by-name can be used to implement
short-circuit evaluation, something that is not possible in Ruby without a
lot of boilerplate introducing lambdas. When you call my_or, it evaluates
arg1 as part of the if statement, that evaluates to true, and it never
evaluates arg2. Therefore, it never tries to send a method to nil and thus
never raises an exception.
</p>
<p>
Works by rewriting:
</p>
<pre>
   with(
     called_by_name(:my_or) { |arg1,  arg2|
       if  arg1
         true
       else
         !!arg2
       end
     }
   ) do
     ...
     my_or(
       true, nil.raise_missing_method_exception
     )
     ...
   end
</pre>
<p>
Into:
</p>
<pre>
   lambda { |my_or|
     ...
     my_or.call(
       lambda { true }, lambda { nil.raise_missing_method_exception }
     )
     ...
   }.call(
     lambda { |arg1,  arg2|
       if arg1.call
         true
       else
         !!arg2.call
       end
     }
   )
</pre>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000010">as_lambda</a>&nbsp;&nbsp;
      <a href="#M000011">new</a>&nbsp;&nbsp;
      <a href="#M000012">process</a>&nbsp;&nbsp;
      <a href="#M000009">splatted?</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="CalledByName.src/M000011.html" target="Code" class="method-signature"
            onclick="popupCode('CalledByName.src/M000011.html');return false;">
          <span class="method-name">new</span><span class="method-args">(name, &amp;proc)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000010" class="method-detail">
        <a name="M000010"></a>

        <div class="method-heading">
          <a href="CalledByName.src/M000010.html" target="Code" class="method-signature"
            onclick="popupCode('CalledByName.src/M000010.html');return false;">
          <span class="method-name">as_lambda</span><span class="method-args">(proc_sexp)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="CalledByName.src/M000012.html" target="Code" class="method-signature"
            onclick="popupCode('CalledByName.src/M000012.html');return false;">
          <span class="method-name">process</span><span class="method-args">(exp)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>

      <div id="method-M000009" class="method-detail">
        <a name="M000009"></a>

        <div class="method-heading">
          <a href="CalledByName.src/M000009.html" target="Code" class="method-signature"
            onclick="popupCode('CalledByName.src/M000009.html');return false;">
          <span class="method-name">splatted?</span><span class="method-args">(proc)</span>
          </a>
        </div>
      
        <div class="method-description">
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>